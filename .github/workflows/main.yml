name: Build Dopamine Custom

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Check out Git repository
      uses: actions/checkout@v4

    - name: Install Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install Dependencies
      run: npm install

    # 第一步：构建 Angular 前端代码 (这是之前缺少的一步)
    - name: Build Angular App
      run: npm run build:prod

    # 第二步：打包成 exe (手动跳过签名验证)
    # 我们直接调用 electron-builder，并强制覆盖配置里的签名设置
    - name: Package Electron App
      run: npx electron-builder build --windows --config electron-builder.config.js -c.win.verifyUpdateCodeSignature=false -c.win.certificateSubjectName=""
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    # 上传生成的文件
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Dopamine-Custom-Build
        path: |
          dist/*.exe
          release/*.exe
