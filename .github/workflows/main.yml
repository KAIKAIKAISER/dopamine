name: Build Dopamine Custom

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Check out Git repository
      uses: actions/checkout@v4

    - name: Install Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 22  # 这里改成了 22，以满足 >=22.12.0 的要求

    - name: Install Dependencies
      # 加上 --force 可以强制忽略一些非关键的依赖冲突，保证安装成功
      run: npm install --force

    - name: Build Angular App
      run: npm run build:prod

    - name: Package Electron App
      # 继续使用跳过签名的参数
      run: npx electron-builder build --windows --config electron-builder.config.js -c.win.verifyUpdateCodeSignature=false -c.win.certificateSubjectName=""
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Dopamine-Custom-Build
        path: |
          dist/*.exe
          release/*.exe
